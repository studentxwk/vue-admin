var $jscomp={scope:{},findInternal:function(d,g,f){d instanceof String&&(d=String(d));for(var h=d.length,m=0;m<h;m++){var k=d[m];if(g.call(f,k,m,d))return{i:m,v:k}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,g,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[g]=f.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,g,f,h){if(g){f=$jscomp.global;d=d.split(".");for(h=0;h<d.length-1;h++){var m=d[h];m in f||(f[m]={});f=f[m]}d=d[d.length-1];h=f[d];g=g(h);g!=h&&null!=g&&$jscomp.defineProperty(f,d,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,f){return $jscomp.findInternal(this,d,f).v}},"es6-impl","es3");
(function(d,g){"function"!==typeof define||!define.amd||"undefined"!=typeof nonUseAmd&&nonUseAmd?g():"undefined"!=typeof HTMLDev&&HTMLDev?define(["./signature"],g):define(["./signature.min"],g)})(window,function(d){function g(a){return Math.sqrt(a.x*a.x+a.y*a.y)}function f(a,b,c){var e;e=1*c.substring(1,c.length);c=c.substring(0,1);e="s"==c?1E3*e:"h"==c?36E5*e:"d"==c?864E5*e:void 0;c=new Date;c.setTime(c.getTime()+1*e);document.cookie=a+"="+escape(b)+";expires="+c.toGMTString()}function h(a){var b;
return(b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(b[2]):null}function m(a){var b=new Date;b.setTime(b.getTime()-1);var c=h(a);null!=c&&(document.cookie=a+"="+c+";expires="+b.toGMTString())}d=window.kinggrid;var k=window.Signature,q=window.jQuery;"use strict";var r=function(a,b){this.preV={x:null,y:null};this.pinchStartLen=null;this.scale=1;this.isDoubleTap=!1;this.rotate=b.rotate||function(){};this.pointStart=b.pointStart||function(){};this.multipointStart=b.multipointStart||
function(){};this.multipointEnd=b.multipointEnd||function(){};this.pinch=b.pinch||function(){};this.swipe=b.swipe||function(){};this.tap=b.tap||function(){};this.doubleTap=b.doubleTap||function(){};this.longTap=b.longTap||function(){};this.singleTap=b.singleTap||function(){};this.pressMove=b.pressMove||function(){};this.x1=this.x2=this.y1=this.y2=this.swipeTimeout=this.longTapTimeout=this.touchTimeout=this.tapTimeout=this.now=this.last=this.delta=null;this.preTapPosition={x:null,y:null};a.addEventListener("touchstart",
this.start.bind(this),!1);a.addEventListener("touchmove",this.move.bind(this),!1);a.addEventListener("touchend",this.end.bind(this),!1);a.addEventListener("touchcancel",this.cancel.bind(this),!1)};r.prototype={start:function(a){if(a.touches){this.now=Date.now();this.x1=a.touches[0].pageX;this.y1=a.touches[0].pageY;this.delta=this.now-(this.last||this.now);this.pointStart(a);null!==this.preTapPosition.x&&(this.isDoubleTap=0<this.delta&&250>=this.delta&&30>Math.abs(this.preTapPosition.x-this.x1)&&30>
Math.abs(this.preTapPosition.y-this.y1));this.preTapPosition.x=this.x1;this.preTapPosition.y=this.y1;this.last=this.now;var b=this.preV;if(1<a.touches.length){var c=a.touches[1].pageY-this.y1;b.x=a.touches[1].pageX-this.x1;b.y=c;this.pinchStartLen=g(b);this.multipointStart(a)}this.longTapTimeout=setTimeout(function(){this.longTap(a)}.bind(this),750)}},move:function(a){if(a.touches){var b=this.preV,c=a.touches.length,e=a.touches[0].pageX,d=a.touches[0].pageY;this.isDoubleTap=!1;if(1<c){c={x:a.touches[1].pageX-
e,y:a.touches[1].pageY-d};if(null!==b.x){0<this.pinchStartLen&&(a.scale=g(c)/this.pinchStartLen,this.pinch(a));var n;n=g(c)*g(b);0===n?n=0:(n=(c.x*b.x+c.y*b.y)/n,1<n&&(n=1),n=Math.acos(n));0<c.x*b.y-b.x*c.y&&(n*=-1);a.angle=180*n/Math.PI;this.rotate(a)}b.x=c.x;b.y=c.y}else null!==this.x2&&(a.deltaX=e-this.x2,a.deltaY=d-this.y2,this.pressMove(a));this._cancelLongTap();this.x2=e;this.y2=d;a.preventDefault()}},end:function(a){if(a.changedTouches){this._cancelLongTap();var b=this;2>a.touches.length&&
this.multipointEnd(a);this.x2&&30<Math.abs(this.x1-this.x2)||this.y2&&30<Math.abs(this.preV.y-this.y2)?(a.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout(function(){b.swipe(a)},0)):this.tapTimeout=setTimeout(function(){b.tap(a);b.isDoubleTap?(b.doubleTap(a),clearTimeout(b.touchTimeout),b.isDoubleTap=!1):b.touchTimeout=setTimeout(function(){b.singleTap(a)},250)},0);this.preV.x=0;this.preV.y=0;this.scale=1;this.x1=this.x2=this.y1=this.y2=this.pinchStartLen=
null}},cancel:function(){clearTimeout(this.touchTimeout);clearInterval(this.tapTimeout);clearInterval(this.longTapTimeout);clearInterval(this.swipeTimeout)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_swipeDirection:function(a,b,c,e){return Math.abs(a-b)>=Math.abs(c-e)?0<a-b?"Left":"Right":0<c-e?"Up":"Down"}};var p=d.Utils;p.extend(k.options.template,{infoBtl:'<div class="kg-dialog kg-dialog-info" id="kg-info"><%var modified = this.modified;%><%var canSign = this.signatureData.signMeta|| this.canSign(); %><div class="kg-content"><div class="kg-tab"><ul class="kg-nav clearfix"><li class=" <% modified?"":"active"%> "><a href="#" kg-target="signatureinfo">\u7b7e\u7ae0\u4fe1\u606f</a></li><%if(canSign){%><li class="" ><a href="#" kg-target="certinfo">\u8bc1\u4e66\u4fe1\u606f</a></li><%}%></ul><div class="kg-tab-content"><div class="kg-tab-pane <% modified?"":"active"%> signatureinfo"><% var SDATA = this.signatureData; %><% var modifiedItems = this.modifiedItems; %><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label">\u68c0\u6d4b\u7ed3\u679c\uff1a</label><span class="kg-value"><%modified?"\u4fdd\u62a4\u6570\u636e\u88ab\u7be1\u6539\uff01":"\u4fdd\u62a4\u6570\u636e\u6b63\u5e38\uff01"%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5e94\u7528\u7a0b\u5e8f\uff1a</label><span class="kg-value"><%SDATA.appname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u6388\u6743\u5355\u4f4d\uff1a</label><span class="kg-value"><%SDATA.orgname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7528\u6237\u540d\u79f0\uff1a</label><span class="kg-value"><%SDATA.username%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5bc6\u94a5\u5e8f\u5217\uff1a</label><span class="kg-value"><%SDATA.keysn%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u540d\u79f0\uff1a</label><span class="kg-value"><%SDATA.seal.signname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u5e8f\u5217\uff1a</label><span class="kg-value"><%SDATA.seal.signsn%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u65e5\u671f\uff1a</label><span class="kg-value"><%SDATA.timestamp.signtime%></span></div></div><div><button type="button" id="revoke_<%this.signatureid%>" class="kg-button ">\u64a4\u9500\u7b7e\u7ae0</button></div></div><%if(canSign){%><div class="kg-tab-pane certinfo"><%var noCertInfo = !this.signatureData.signMeta; %><%if(!noCertInfo){%><%var certinfo = this.signatureData.signMeta.certinfo; %><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label">\u7248\u672c\uff1a</label><span class="kg-value">V<%certinfo.version%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5e8f\u53f7\uff1a</label><span class="kg-value"><%certinfo.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u540d\u7b97\u6cd5\uff1a</label><span class="kg-value"><%certinfo.algName%></span></div><div class="clearfix kg-item "><label class="kg-label">\u9881\u53d1\u8005\uff1a</label><span class="kg-value"><%certinfo.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label">\u4f7f\u7528\u8005\uff1a</label><span class="kg-value"><%certinfo.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label">\u6709\u6548\u671f\u4ece\uff1a</label><span class="kg-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notBefore) , "yyyy-MM-dd hh:mm:ss")%></span></div><div class="clearfix kg-item "><label class="kg-label">\u81f3\uff1a</label><span class="kg-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notAfter) , "yyyy-MM-dd hh:mm:ss")%></span></div></div><%}else{%><div class="kg-meta"><div class="clearfix kg-item kg-visble "><label class="kg-label"></label><span class="kg-value">----------------------------------------------------------------------------------------------------------------------</span></div><div class="clearfix kg-item kg-nosign"><label class="kg-label">\u63d0\u793a\u4fe1\u606f\uff1a</label><span class="kg-value">\u5f53\u524d\u6587\u6863\u672a\u505a\u6570\u5b57\u7b7e\u540d</span></div><div class="clearfix kg-item kg-visble"><label class="kg-label"></label><span class="kg-value">--------------------------------------------------------------------</span></div></div><%}%><%if(noCertInfo){%><div><button type="button" id="sign_<%this.signatureid%>" class="kg-button">\u6570\u5b57\u7b7e\u540d</button></div><%}else{%><div><button type="button" id="verifysign_<%this.signatureid%>" class="kg-button">\u7b7e\u540d\u9a8c\u8bc1</button></div><%}%></div><%}%></div></div></div></div>',
handwritedlg:'<div class="kg-dialog kg-dialog-info" id="kg-handwrite">\u540d\u79f0:<input type="text" value="\u624b\u5199\u7b7e\u540d" id="nameid" />&nbsp;&nbsp;&nbsp;\u989c\u8272:<select id="hw_color"><option value="black">\u9ed1</option><option value="red">\u7ea2</option><option value="blue">\u84dd</option><option value="green">\u7eff</option></select>&nbsp;&nbsp;&nbsp;\u7b14\u5bbd:<select id="hw_width"><option value="1">1</option><option value="2" selected>2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option></select><canvas id="canvasId" width=700px height=300px></canvas><br /><div id="div-judge" class="kg-tab-content" align="center"><button type="button" id="clearid" class="kg-button">\u6e05\u9664</button><button type="button" id="okid" class="kg-button">\u7b7e\u540d</button></div></div>',
barcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-barcode"><label class="kg-label">\u4e8c\u7ef4\u7801\u5185\u5bb9\uff1a</label><textarea id="bcId" align="center"></textarea><br /><div id="output"><br /></div><div id="div-judge" class="kg-tab-content"><button type="button" id="bc_clearid" class="kg-button">\u6e05\u9664</button><button type="button" id="bc_okid" class="kg-button">\u786e\u5b9a</button></div></div>',scanbarcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-scanBC"><div id="contentHolder" style="width:320px;height:320px; background:red;"><video id="html5_qrcode_video" height="320px" width="320px" autoplay></video><canvas id="qr-canvas" width="320px" height="320px" style="display:none;"></canvas> <br/> </div></div>'});
k._create.prototype.onshowSealsDialog=function(a){var b=this;a.find(".arrow").hide();a=a.find("#kg-switcher");b.switcher.animate=!1;new r(a[0],{swipe:function(a){b.switcher["Left"===a.direction?"swipePrev":"swipeNext"]()},tap:function(){b.switcher.swipeNext()}})};k.prototype.onhandleImg=function(a){var b=this,c=function(){b.verify();b.signatureInfo()},e=function(){if(void 0!==k.options.extra){var b=a.attributes.signatureid.nodeValue;if(b&&(b=k.options.extra[b],null!=b))return b.icon_move()}}(),e=
void 0==e?!0:e;b.canMove(a)&&e?p.addEvent(a,"mousedown touchstart",function(e){e.originalEvent=e;b.runMove(e,a,function(a){a||c()});e.preventDefault();e.stopPropagation()}):p.addEvent(a,"click",c)};k.prototype.signatureInfo=function(){var a=this;return a.showDialog("infoBtl",{title:!1,target:a,onShow:function(){var b=this,c=b.find(".kg-tab");b.tab=p.tab(c);if(c=b.find("#verifysign_"+a.signatureid)[0])c.onclick=function(){a.verifySignData(function(b){b.result?a.warning("\u7b7e\u540d\u6570\u636e\u9a8c\u8bc1\u6b63\u5e38"):
b.errcode?a.warning(b):a.warning("\u7b7e\u540d\u6570\u636e\u88ab\u7be1\u6539")})};if(c=b.find("#sign_"+a.signatureid)[0])c.onclick=function(){a.signSignature(function(c){c.result&&(a.warning("\u6570\u5b57\u7b7e\u540d\u6210\u529f\uff01"),b.remove())})};b.find("#revoke_"+a.signatureid)[0].onclick=function(){a.revokeSignature(function(a){a.result&&b.remove()})}}})};k.prototype.handWriteDlg=function(a,b){if(a.width&&a.height){var c=k.options.template.handwritedlg,e=c.substring(0,c.indexOf("width=")+6),
d=c.substring(c.indexOf("px "),c.length),e=e+a.width,e=e+d,c=e.substring(0,e.indexOf("height=")+7),d=e.substring(e.indexOf("px>"),e.length),c=c+a.height;k.options.template.handwritedlg=c+d}var g=this.showDialog("handwritedlg",a),c=document.getElementById("canvasId");a.penColor=document.getElementById("hw_color").value;a.minWidth=.5;a.maxWidth=4.5;var l=new SignaturePad(c,a),f=document.getElementById("hw_color");f.onchange=function(){l.penColor=f.value};var h=document.getElementById("hw_width");h.onchange=
function(){switch(h.value){case "1":l.minWidth=.5;l.maxWidth=2.5;break;case "2":l.minWidth=.5;l.maxWidth=4.5;break;case "3":l.minWidth=1;l.maxWidth=6;break;case "4":l.minWidth=1;l.maxWidth=8;break;case "5":l.minWidth=2.5;l.maxWidth=10;break;case "6":l.minWidth=3;l.maxWidth=12;break;default:l.minWidth=.5,l.maxWidth=2.5}};c=document.getElementById("clearid");e=document.getElementById("okid");c&&(c.onclick=function(){l.clear()});e&&(e.onclick=function(){g.close();var c=l.toDataURL().replace(/^data:image\/\w+;base64,/,
"");c&&(c={height:a.image_height||"3.00",width:a.image_width||"7.00",imageData:c,name:document.getElementById("nameid").value},b(c))})};k.prototype.barCodeDlg=function(a,b){var c=this.showDialog("barcodedlg",{title:"\u4e8c\u7ef4\u7801",target:this,onCancel:!1}),d=document.getElementById("bc_clearid"),f=document.getElementById("bc_okid"),g=document.getElementById("bcId");d&&(d.onclick=function(){g.value=""});f&&(f.onclick=function(){c.close();var d=q("#output").qrcode(g.value);b({height:a.image_height||
"5",width:a.image_width||"5",imageData:d,name:"\u4e8c\u7ef4\u7801"})})};k.prototype.scanBCDlg=function(a,b){var c=this.showDialog("scanbarcodedlg",{title:"\u626b\u7801\u7b7e\u7ae0",target:this,onCancel:!1});try{var d=document.getElementById("qr-canvas").getContext("2d"),f=document.getElementById("html5_qrcode_video");navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||
window.msURL;navigator.getUserMedia&&navigator.getUserMedia({video:!0,audio:!1},function(a){f.src=window.URL.createObjectURL(a);f.play()},function(a){alert("\u51fa\u9519\u4fe1\u606f: "+err.name)});var g=setInterval(function(){if(d){d.drawImage(f,0,0,640,480);var e=d.getImageData(0,0,640,480);if(e=jsQR.decodeQRFromImage(e.data,e.width,e.height))c.close(),window.clearInterval(g),a.content=e,e={height:a.image_height||"5",width:a.image_width||"5",imageData:q("#output").qrcode(e),name:"\u4e8c\u7ef4\u7801"},
b(e)}},2E3)}catch(l){printHtml("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301HTML5 CANVAS")}};k.prototype.onshowSealsDialog_PW=function(a){var b=this.keysn||this.keyData.keysn;"true"==h("ck")&&a.find("#kg-remenberPwd").attr("checked","checked");if(a.find("#kg-remenberPwd").is(":checked")){var c=h("ksn");b==c&&(a=a.find("#kg-password"),b=h("pwd"),null!=b?a.val(b):a.val("123"))}};k.prototype.onexecSuccess=function(a,b,c){a=this.keysn||this.keyData.keysn;if(c){if(c=h("ksn"),a!=c){c=k.options.pw_timeout;if("undefined"==
typeof c||0>c.indexOf("s")&&0>c.indexOf("h")&&0>c.indexOf("d"))c="s1800";f("ksn",a,c);f("pwd",b,c);f("ck","true",c)}}else m("ksn"),m("pwd"),m("ck")};d=kingPlus();p.extend(d.alertConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1});p.extend(d.loadingConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1});p.extend(d.dialogConfig,{cancelDisplay:!1,quickClose:!0});return k});
// V1.0.0.312    
//# sourceMappingURL=c:/signature.pc.min.map
